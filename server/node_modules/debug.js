/**
 * Created by bcouriol on 27/06/14.
 */

/**
 * Created by bcouriol on 1/06/14.
 */

var DBG_INDENT_PREFIX = "";
const DBG_INDENT_STRING = "--";
const DBG_INDENT_STRING_LENGTH = DBG_INDENT_STRING.length;

exports.TAG = {
   TRACE  : "Trace",
   INFO   : "Info",
   ERROR  : "Error",
   WARNING: "Warning",
   DEBUG  : "DEBUG"};
exports.FLAG = {
   TRACE  : "True",
   INFO   : "True",
   ERROR  : "True",
   WARNING: "True",
   DEBUG  : "True"};
exports.SEP = {
   SPACE: " ",
   TAG  : ": ",
   ARG  : ":: ",
   NAME : ":: "
};

const DBG_MAX_CHAR = 40;
const DBG_CHAR_IN = ">";
const DBG_CHAR_OUT = "<";

exports.entry = function (context) {
   //context should be the function from which the logEntry is called
   DBG_INDENT_PREFIX += DBG_INDENT_STRING;
   logWrite(DBG.TAG.TRACE, DBG_INDENT_PREFIX + DBG_CHAR_IN + DBG.SEP.SPACE + context.toString().slice(0, DBG_MAX_CHAR));
};

exports.exit = function (context) {
   //context should be the function from which the logEntry is called
   if (DBG_INDENT_PREFIX.length >= DBG_INDENT_STRING_LENGTH) {
      logWrite(DBG.TAG.TRACE,
               DBG_CHAR_OUT + DBG_INDENT_PREFIX + DBG.SEP.SPACE + context.toString().slice(0, DBG_MAX_CHAR));
      DBG_INDENT_PREFIX = DBG_INDENT_PREFIX.slice(0, DBG_INDENT_PREFIX.length - DBG_INDENT_STRING_LENGTH);
   } else {
      logWrite(DBG.TAG.ERROR, "logExit called probably without matching logEntry");
   }
};

exports.write = function (tag, text, arg) {
   //just writes some text to some output terminal (console, or else)
   //however in function of the tag, one could decide to change the terminal
   // for example trace data could go to a specific file or terminal
   /*
    Add parameters validation : text can't be null or undefined
    */
   var i;
   if (tag === DBG.TAG.DEBUG && !DBG.FLAG.DEBUG) {
      return;
   }
   if (arg) {
      for (i = 2; i != arguments.length; i++) {
         if (!arguments[i]) {
            text += DBG.SEP.ARG + "??"
         } else {
            text += DBG.SEP.ARG + arguments[i].toString();
         }
      }
   }
   console.log(tag + DBG.SEP.TAG + text);
};

exports.setDebugMode = function (tag, flag) {
   /*
    for the moment one mode, if parameter is false, then don't print the logWrite DEBUG
    INPUT : debug_mode : boolean (true or false)
    */
   DBG.FLAG[tag] = flag;
};
